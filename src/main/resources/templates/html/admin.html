<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>欢迎页面-L-admin1.0</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,admin-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="../css/font.css">
    <link rel="stylesheet" href="../css/xadmin.css">
    <script src="../js/jquery.min.js"></script>
    <script type="text/javascript" src="../lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="../js/xadmin.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<style>
    .diy, input{
        width: 25%;
    }
    .diy{
        height: 200px;
    }
</style>
<body>
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
    <a class="layui-btn layui-btn-xs" lay-event="text">图表测试</a>
</script>

<xblock>
    <button class="layui-btn layui-btn-danger" onclick="delAll()"><i class="layui-icon"></i>批量删除</button>
    <button STYLE="" class="layui-btn" onclick="x_admin_show('添加','/insertAdmin',800,800)"  lay-event="insert"><i class="layui-icon"></i>添加</button>
    <div style="float: right;" class="layui-form layui-card-header layuiadmin-card-header-auto ">
        <div class="layui-form-item">
            <div class="layui-inline">
                <div class="layui-input-block">
                    <input type="text" id="AdminName" placeholder="请输入" autocomplete="off" class="form-control layui-input">
                </div>
            </div>

            <div class="layui-inline">
                <button style="height: 35px" class="layui-btn layui-btn-sm layui-form-label" lay-event="getCheckData" id="seAdminName">搜索姓名</button>
                <div class="layui-input-block">
                    <input type="text" id="AdminN" placeholder="请输入" autocomplete="off" class="form-control layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <button style="height: 35px" class="layui-btn layui-btn-sm layui-form-label" lay-event="getCheckData" id="seAdminN">真实姓名</button>
            </div>
        </div>
    </div>

    <form action="UserInfoExcel" method="post" id="illegalDevice">
        <input type="submit" name="export" class="layui-btn" id="exportButton" value="导出报表"/>
    </form>
</xblock>
<table class="layui-table" id="admin" lay-filter="admin" ></table>
<img src="{{d.works}}" style="width: 100px;height:80px ">
</div>

<script>
    layui.use(['laydate','table'],function(){
        var laydate = layui.laydate;
        var table = layui.table;
        var url="/adminList";
        $("#seAdminN").click(function(){
            var adminN = $("#AdminN").val();
            table.reload('tadmin', {
                where: {
                    adminN :null,
                    adminName:null
                }
                ,page: {
                    curr: 1 //重新从第 1 页开始
                }
            });
            table.reload('tadmin', {
                where: {
                    adminN: adminN,
                    adminName:null
                }
                ,page: {
                    curr: 1 //重新从第 1 页开始
                }
            }); //只重载数据
        });
        $("#seAdminName").click(function(){
            var adminName = $("#AdminName").val();
            table.reload('tadmin', {
                where: {
                    adminN :null,
                    adminName:null
                }
                ,page: {
                    curr: 1 //重新从第 1 页开始
                }
            });
            table.reload('tadmin', {
                where: {
                    adminName: adminName,
                    adminN :null
                }
                ,page: {
                    curr: 1 //重新从第 1 页开始
                }
            }); //只重载数据
        });
        //执行一个laydate实例
        laydate.render({
            elem: '#start' //指定元素
        });
        //执行一个laydate实例
        laydate.render({
            elem: '#end' //指定元素
        });
        //表格式化
        table.render({
            id:"tadmin",
            elem: '#admin',
            url:url,
            title:'管理员用户表',
            cols:[ [
                {type:'checkbox',fixed:'left'},
                {field:'adminid', title:'ID', width:"10%", edit: 'text',unresize: true, sort: true, totalRowText: '合计'},
                {field:'adminName', title:'用户名', width:"10%", edit: 'text' ,sort: true, totalRow: true},
                {field:'adminPwd', title:'密码', width:"10%", edit: 'text', sort: true, totalRow: true},
                {field:'adminN', title:'真实姓名', width:"10%", edit: 'text'},
                {field:'adminEmail', title:'邮箱', width:"10%", edit: 'text'},
                {field:'adminPhone', title:'电话', width:"10%", edit: 'text'},
                {field:'adminType', title:'类型', width:"10%", edit: 'text'},
                {field:'adminTime', title:'创建时间', width:"10%", edit: 'text'},
                {fixed: 'right', title:'操作', toolbar: '#barDemo', width:"20%"},

            ] ]
            ,page:true
            ,limit:10
        });
    });

</script>
<script>
    layui.use(['table'], function(){
        var table = layui.table;
        //监听行工具事件
        table.on('tool(admin)', function(obj){
            var data = obj.data;
            console.log(data)
            // 删除操作
            if(obj.event === 'del'){
                layer.confirm('真的删除行么', function(index){
                    $.ajax({
                        url: "/adminDelete",
                        type:"get",
                        dataType: "json",
                        data : {"adminName" : data.adminName,"adminid" : data.adminid},
                        success: function(data){
                            if(data.status == 1){
                                alert("删除成功");
                                location.reload();
                            }
                            else{
                                alert("删除失败了，请联系管理员。");
                            }
                        },
                        error:function (e) {
                            console.log("失败");
                        }
                    });
                    obj.del();
                    layer.close(index);
                });
            }
            // 编辑操作
            else if(obj.event === 'edit'){
                x_admin_show('编辑','/adminEdit?adminid='+data.adminid,800,800);
            }else if(obj.event === 'text'){
                x_admin_show('编辑','/text?adminid='+data.adminid,800,800);
            }

        });

    });

</script>
</body>

</html>